---
import { getCollection } from 'astro:content'
import Markdown from '@components/misc/Markdown.astro'
import I18nKey from '@i18n/i18nKey'
import { i18n } from '@i18n/translation'
import MainGridLayout from '@layouts/MainGridLayout.astro'
import { Icon } from 'astro-icon/components'

export async function getStaticPaths() {
  const projectEntries = await getCollection('projects')
  return projectEntries.map(entry => ({
    params: { slug: entry.slug },
    props: { entry },
  }))
}

const { entry } = Astro.props
const { Content } = await entry.render()

const jsonLd = {
  '@context': 'https://schema.org',
  '@type': 'SoftwareApplication',
  name: entry.data.title,
  description: entry.data.description,
  image: entry.data.image,
  keywords: entry.data.tags,
}
---
<MainGridLayout banner={entry.data.image} title={entry.data.title} description={entry.data.description}>
    <script is:inline slot="head" type="application/ld+json" set:html={JSON.stringify(jsonLd)}></script>

    <!-- Back to projects link -->
    <div class="mb-4">
        <a href="/projects" class="inline-flex items-center gap-2 text-[var(--primary)] hover:underline transition onload-animation">
            <Icon name="material-symbols:arrow-back-rounded" class="text-xl" />
            <span>Back to {i18n(I18nKey.projects)}</span>
        </a>
    </div>

    <div class="flex w-full rounded-[var(--radius-large)] overflow-hidden relative mb-4">
        <div id="project-container" class="card-base z-10 px-6 md:px-9 pt-6 pb-4 relative w-full">

            <!-- title -->
            <div class="relative onload-animation">
                <div
                    class="transition w-full block font-bold mb-3
                    text-3xl md:text-[2.25rem]/[2.75rem]
                    text-black/90 dark:text-white/90
                    md:before:w-1 before:h-5 before:rounded-md before:bg-[var(--primary)]
                    before:absolute before:top-[0.75rem] before:left-[-1.125rem]
                ">
                    {entry.data.emoji && <span class="mr-2">{entry.data.emoji}</span>}
                    {entry.data.title}
                </div>
            </div>

            <!-- tags -->
            {entry.data.tags && entry.data.tags.length > 0 && (
                <div class="flex flex-wrap gap-2 mb-5 onload-animation">
                    {entry.data.tags.map((tag: string) => (
                        <span class="text-sm px-3 py-1 rounded-md bg-[var(--primary)]/10 text-[var(--primary)] transition">
                            {tag}
                        </span>
                    ))}
                </div>
            )}

            <!-- links -->
            {entry.data.links && entry.data.links.length > 0 && (
                <div class="flex flex-wrap gap-3 mb-5 onload-animation">
                    {entry.data.links.map((link: any) => (
                        <a
                            href={link.url}
                            target="_blank"
                            rel="noopener noreferrer"
                            class="inline-flex items-center gap-2 px-4 py-2 rounded-lg bg-[var(--primary)] text-white hover:opacity-90 transition active:scale-95"
                        >
                            <Icon name="material-symbols:open-in-new-rounded" class="text-lg" />
                            <span>{link.name}</span>
                        </a>
                    ))}
                </div>
            )}

            {entry.data.tags && entry.data.links && <div class="border-[var(--line-divider)] border-dashed border-b-[1px] mb-5 onload-animation"></div>}

            <Markdown class="mb-6 markdown-content onload-animation">
                <Content />
            </Markdown>

        </div>
    </div>

</MainGridLayout>
